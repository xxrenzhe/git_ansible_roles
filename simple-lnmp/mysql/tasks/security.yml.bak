---
# File: security.yml
# Type: task
# Part: MySQL

#- name: MySQL | Check if mysqld initialed
#  mysql_user: host=localhost login_user=root login_password="" check_implicit_admin=yes
#  register: mysql_need_initial

- name: MySQL | Remove empty password users
  mysql_user: name="" password="" host=localhost login_user=root login_password="" state=absent check_implicit_admin=yes priv=*.*:"USAGE"
- name: MySQL | Remove empty password users
  mysql_user: name="" password="" host={{ ansible_fqdn }} state=absent login_user=root login_password="" check_implicit_admin=yes priv=*.*:"USAGE"
- name: MySQL | Remove the MySQL test database
  mysql_db: db=test state=absent login_user=root login_password="" check_implicit_admin=yes
- name: MySQL | Set initial password for user root@localhost
  mysql_user: name=root password={{ mysql_root_password }} host=localhost state=present login_user=root login_password="" check_implicit_admin=yes
- name: MySQL | Set initial password for user root@xxoo
  mysql_user: name=root password={{ mysql_root_password }} host={{ item }} state=present login_user=root login_password={{ mysql_root_password }}
  with_items:
    - 127.0.0.1
    - "{{ ansible_fqdn }}"
